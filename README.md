# DeepL PDF Translator

PDFファイルを無料版のDeepLで自動的に翻訳するソフトです。  
PDFファイルから人力で文章をコピーして、随所に挟まる改行を消してペーストして、翻訳文をまたコピーして……という作業からの解放を目的としています。

## 使い方

Windowsをお使いの方は右上のReleaseページからzipファイルをダウンロードして解凍・起動してください。  
MacOSをお使いの方は以下の手順で環境構築を行ってください。

1. `pip install -r requirements.txt`で必要なライブラリを入手してください。事前に`pip install --upgrade pip`でpipをアップデートしておくと、エラーが減るかもしれません。パーミッションエラーでインストールが正常に完了しない場合は、管理者権限で実行してください。
2. `python main.py`で起動します。

起動するとウィンドウが出るので、そこに翻訳したいPDFファイルをドラッグ&ドロップしてください。複数ファイルの入力にも対応しています。  
翻訳が終わると`output`ディレクトリにtxtファイルが出力されます。

最低限の翻訳機能に加えて、

- 指定の部分での翻訳開始/終了(翻訳が乱れやすい冒頭や、翻訳の不要な参考文献などを除く用)
- 指定の文字列を含む行の無視(ヘッダーやフッター、ページ数などを除く用)
- 指定の文字列の置換(上記の機能を用いてもヘッダーやフッターなどの余計なテキストが本文中に入り込んでしまう際の除去)
- 図表テキストと本文の分離
- 指定の文字列を含む行で改行(文末や見出し用)
- 略語などの、文末っぽく見えるが文末ではない部分では改行しないよう指定する
- Markdown形式での出力(見出しと見なす文字列を指定すればMarkdown式の見出しで出力)

などの機能があり、それらの設定が、メインウインドウの`編集 > 正規表現の編集`から行えます。  
**適切な設定(特に無視やノイズ除去)を行えば、かなり実用に耐える翻訳文を出力できるようになっています**。  
また、製作者がObsidianというMarkdownメモアプリの利用者なので、**Obsidianユーザにはかなり恩恵がある設計**になっています。

また、主な対象は英字論文を想定しているので、それ以外のPDF文書の翻訳については動作を保証していません(特に現実の書類をスキャンした文書など)。

## アップデート

exeファイルを利用している場合は、新しいexeファイルのみを今まで利用してきた方のフォルダに入れればOKです。  
設定ファイル(`settings.json`)などは、新しいバージョンで追加された設定も自動で書き加えられるようになっています。  
ただし、**バージョン間で既存の設定の構造が変わる可能性**があり、そのような設定の変化の間を取り持つ(コンバート)機能が実装されず古い構造の設定が消去されることも考えられるため、アップデートを行う際は、念の為に設定ファイルのバックアップを取っておくことをおすすめします。

exeファイルを利用していない場合は、必要なPythonライブラリが追加されている可能性があるため、`pip install -r requirements.txt`を実行しておくと良いでしょう。

## アンインストール

このソフトウェアのディレクトリ(フォルダ)を消去してください。  
また、自動でダウンロードされたWebDriverが`(ユーザーディレクトリ)/.wdm`に入っているので、`.wdm`ディレクトリも消去すれば完全に元の状態に戻ります。

## 動作環境

OS: Windows, MacOS  
Python: 3.7.9(実行ファイルを利用しない場合)
- Chrome
- Edge
- FireFox

### 注意点

<details>
<summary>MacOSで実行する場合</summary>

```
This program needs access to the screen. Please run with a Framework build of python, and only when you are logged in on the main display of your Mac.
```

という出力がなされ、GUIが出現しない場合があります。  
その場合は、Framework buildのPythonを入手してください。  
pyenvを利用している場合は、

```
env PYTHON_CONFIGURE_OPTS="--enable-framework" pyenv install 3.7.9
```

で入手可能です。その後、pyenvで利用するPythonのバージョンを3.7.9に切り替え、

```
pip install --upgrade pip
pip install -r requirements.txt
```

を実行して必要なライブラリをインストールし、対応するWebDriverを`drivers`ディレクトリに入れて起動してください。  
なお、その際にセキュリティによってWebDriverが起動できない場合があります。  
その場合は、`システム環境設定 > セキュリティとプライバシー`からWebDriverの実行を許可してください。

</details>

---

## 既知の不具合

- Linux(Ubuntu)において、抽出されるテキストが明らかに少なく、正常に動作しない。
- DeepLのページで翻訳先の言語を選択する際に、そこそこの頻度でエラーが発生する。ウェイトを挟む必要があるか？
- Chromeを用いると、絵文字などのUnicode文字が含まれた文章をDeepLに打ち込めない。FireFoxで回避可能。
- `1.2.3 Header`のような、見出し番号の末尾にピリオドが付いていない番号振りの見出しについて、Markdown式の見出しを適切な大きさに設定することができない。また、そのような見出しの日本語訳の先頭の番号を適切に除去することができない。

<details>
<summary>例</summary>

```
原文
1 Header1
1.1 Header2

理想
## Header1
ヘッダー1
### Header2
ヘッダー2

現実
## Header1
ヘッダー1
## Header2
1 ヘッダー2
```

</details>

## 実装したい機能

- 環境を整えるのが苦手な人のために、実行可能ファイルとしてリリースしたい(優先度は~~Windows~~(済) > Mac > Linuxで。Linux使いの人は自分で環境を整えられるはず)。
- プログレスバーウインドウのレイアウト改善
- 正規表現ヘルパー(正規表現がわからない人でも簡単に正規表現が生成できる仕組み)
- 正規表現のインポート・エクスポート機能
- 翻訳文に対する置換機能
- 置換機能において、ヒットした部分を残しつつ文字列を付け加える機能
- Redo, Undoなどのショートカットキー対応
- ドラッグ&ドロップで正規表現リストの順番編集
- Markdown(Obsidian)出力時に参考文献への参照を脚注に加工して出力したい
- 複数タブでDeepLページを開くことによる翻訳作業の並列化。ただし、月額課金を行わない状態での文書まるごと自動翻訳という時点でかなりグレーな領域に踏み込んでいる上、同一IPからの複窓&大量の翻訳要求は確実に検知されるので実装優先度はごく低い。現状でも他事をしている間に翻訳は終わるので。

## バージョン履歴

### v1.0.0
<details open>

- 各種正規表現を編集するウインドウを追加
- 個々の正規表現パターンごとに、「有効/無効」・「大文字と小文字の区別をするか」を設定する機能を追加
- ファイル選択ダイアログでキャンセルした時のエラーを修正
- 翻訳文のある一行が空文字列だった場合にエラーが発生していたのを修正

</details>

### v0.7.0
<details>

- 翻訳の進捗度を示すプログレスバーを表示する機能を追加
- 翻訳中にメインウインドウが応答なしになる問題を解決
- 複数ファイルの並列翻訳が可能に
- `出力をMarkdown式にする`か`原文を出力する`のどちらかが無効のとき、`原文をコメントとして出力する`のチェックボックスを無効にする機能を追加
- 翻訳開始時に、DeepLを開いたウェブブラウザのウインドウを自動的に最小化する機能を追加

</details>

### v0.6.0
<details>

- メインウインドウの設定の保存機能を追加。次回起動時に前回終了時の設定が再現される

</details>

### v0.5.0
<details>

- ファイル選択メニューから翻訳対象を選択可能に
- 翻訳先の言語を選択する機能を追加
- **WebDriverを自動で取得するように変更**
- Firefoxで原文の入れ替えがうまくいかなくなっていたのを修正
- **実行ファイルでの提供を開始(Windows)**

</details>

### v0.4.2
<details>

- 各種正規表現にヒットした行の出力機能を強化

</details>

### v0.4.1
<details>

- `翻訳文を一文ごとに改行する`のチェックを外すと出力が空文字列になる問題を修正
- 原文を出力するかどうか選べる機能を追加
- Markdownでの出力時、原文をコメントとして出力する機能を追加
- 翻訳完了の基準を変更し、翻訳作業を高速化

</details>

### v0.4.0
<details>

- 見出しの識別が上手く動作しなかった問題を修正
- Markdown式で見出しを出力する機能を追加
- Markdown用の除去/置換機能を追加
- 一行ごとの改行・Markdown式の出力を管理するGUIのチェックボックスを追加

</details>

### v0.3.1
<details>

- MacOS, Chromeでの動作を確認
- MacOS環境下にて、DeepLのページで以前の翻訳対象文を削除できない問題を修正

</details>

### v0.3.0
<details>

- 翻訳を開始/終了する位置を正規表現によって指定可能に
- フォーマットの都合上混じってしまうノイズの除去/置換機能を追加
- 翻訳文を一文ごとに改行する機能を追加(Markdown方式にも対応)
- 後に文が続きそうな略語(et al. や e.g.など)では改行しないように修正
- 行末のハイフン(-)の処理を修正

</details>

### v0.2.0
<details>

- MacOS、Linuxに対応(動作未確認)
- Edge、FireFoxに対応
- ブラウザの選択機能を追加

</details>

### v0.1.0
<details>

- 最低限の翻訳機能を実装
- 文書先頭あたりはレイアウトが複雑なので、有効な翻訳はほぼ無理
- ページにまたがる文章や、図表を挟んだ文章の順序が怪しい
- 画像周辺の文章に謎の文字列が入ることがある。画像のタグか何かか？
- 総評として、全て人力でコピペする労力からは解放されるが、まだまだ修正のコストが高い。

</details>

## 免責事項

私(KashiPrg)は、このアプリケーションによってもたらされたいかなる損害に関しても一切責任を負いません。
